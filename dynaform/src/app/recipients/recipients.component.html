<div class="app-container">
  <!-- Header -->
  <app-header subtitle="Recipient Management"></app-header>

  <div class="main-content">
    <div class="recipients-container">
      <!-- View Mode Toggle -->
      <div class="view-toggle-section">
        <mat-button-toggle-group [value]="viewMode" (change)="onViewModeChange($event)">
          <mat-button-toggle value="recipients">
            <mat-icon>people</mat-icon>
            <span>{{ 'recipients.toggle.recipients' | translate }}</span>
          </mat-button-toggle>
          <mat-button-toggle value="groups">
            <mat-icon>group_work</mat-icon>
            <span>{{ 'recipients.toggle.groups' | translate }}</span>
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>

      <!-- Controls Section -->
      <div class="controls-section">
        <div class="search-container">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label i18n="@@recipients.search.label">{{ viewMode === 'recipients' ? 'Search recipients' : 'Search groups by alias or description' }}</mat-label>
            <input matInput 
                   [formControl]="searchControl"
                   [placeholder]="viewMode === 'recipients' ? 'Search by name, email, job title, or company...' : 'Search by alias name or description...'"
                   i18n-placeholder="@@recipients.search.placeholder">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
          <radix-button variant="ghost" *ngIf="searchTerm" (onClick)="clearSearch()">
            <mat-icon>clear</mat-icon>
            <span i18n="@@recipients.search.clear">Clear</span>
          </radix-button>
        </div>
        
        <div class="action-buttons">
          <!-- Recipients View Actions -->
          <ng-container *ngIf="viewMode === 'recipients'">
            <radix-button variant="primary" (onClick)="openCreateDialog()">
              <mat-icon>add</mat-icon>
              <span>{{ 'recipients.add.button' | translate }}</span>
            </radix-button>
            <radix-button variant="secondary" (onClick)="exportRecipients()">
              <mat-icon>download</mat-icon>
              <span>{{ 'recipients.export.button' | translate }}</span>
            </radix-button>
          </ng-container>
          
          <!-- Groups View Actions -->
          <ng-container *ngIf="viewMode === 'groups'">
            <radix-button variant="primary" (onClick)="openCreateGroupDialog()">
              <mat-icon>add</mat-icon>
              Create Group
            </radix-button>
            <radix-button variant="secondary" (onClick)="exportGroups()">
              <mat-icon>download</mat-icon>
              Export Groups
            </radix-button>
          </ng-container>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-container">
        <mat-progress-spinner diameter="50" mode="indeterminate"></mat-progress-spinner>
        <p>{{ viewMode === 'recipients' ? 'Loading recipients...' : 'Loading groups...' }}</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
        <radix-button variant="primary" (onClick)="viewMode === 'recipients' ? loadRecipients() : loadRecipientGroups()">
          Try Again
        </radix-button>
      </div>

      <!-- Recipients View -->
      <div *ngIf="!loading && !error && viewMode === 'recipients'" class="table-container">
        <div *ngIf="recipients.length === 0" class="empty-state">
          <mat-icon class="empty-icon">people_outline</mat-icon>
          <h3>No recipients found</h3>
          <p *ngIf="searchTerm">No recipients match your search criteria.</p>
          <p *ngIf="!searchTerm">You haven't added any recipients yet.</p>
          <radix-button variant="primary" (onClick)="openCreateDialog()">
            <mat-icon>add</mat-icon>
            Add First Recipient
          </radix-button>
        </div>

        <div *ngIf="recipients.length > 0" class="table-wrapper">
          <table mat-table [dataSource]="recipients" class="recipients-table">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let recipient">
                <div class="name-cell">
                  <mat-icon class="avatar-icon">person</mat-icon>
                  <span>{{ recipient.name }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Job Title Column -->
            <ng-container matColumnDef="jobTitle">
              <th mat-header-cell *matHeaderCellDef>Job Title</th>
              <td mat-cell *matCellDef="let recipient">{{ recipient.jobTitle }}</td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let recipient">
                <a [href]="'mailto:' + recipient.email" class="email-link">{{ recipient.email }}</a>
              </td>
            </ng-container>

            <!-- Company Column -->
            <ng-container matColumnDef="companyName">
              <th mat-header-cell *matHeaderCellDef>Company</th>
              <td mat-cell *matCellDef="let recipient">{{ recipient.companyName }}</td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let recipient">
                <div class="action-buttons-cell">
                  <radix-button variant="ghost" size="icon"
                          (onClick)="openEditDialog(recipient)"
                          [attr.title]="'Edit recipient'">
                    <mat-icon>edit</mat-icon>
                  </radix-button>
                  <radix-button variant="destructive" size="icon"
                          (onClick)="deleteRecipient(recipient)"
                          [attr.title]="'Delete recipient'">
                    <mat-icon>delete</mat-icon>
                  </radix-button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </div>

      <!-- Groups View -->
      <div *ngIf="!loading && !error && viewMode === 'groups'" class="table-container">
        <div *ngIf="recipientGroups.length === 0" class="empty-state">
          <mat-icon class="empty-icon">group_work</mat-icon>
          <h3>No recipient groups found</h3>
          <p *ngIf="searchTerm">No groups match your search criteria.</p>
          <p *ngIf="!searchTerm">You haven't created any recipient groups yet.</p>
          <radix-button variant="primary" (onClick)="openCreateGroupDialog()">
            <mat-icon>add</mat-icon>
            Create First Group
          </radix-button>
        </div>

        <div *ngIf="recipientGroups.length > 0" class="table-wrapper">
          <table mat-table [dataSource]="recipientGroups" class="recipients-table">
            <!-- Alias Name Column -->
            <ng-container matColumnDef="aliasName">
              <th mat-header-cell *matHeaderCellDef>Alias Name</th>
              <td mat-cell *matCellDef="let group">
                <div class="name-cell">
                  <mat-icon class="avatar-icon">group_work</mat-icon>
                  <span class="alias-name">{{ group.aliasName }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let group">
                <span class="description-text">{{ group.description || 'No description' }}</span>
              </td>
            </ng-container>

            <!-- Recipient Count Column -->
            <ng-container matColumnDef="recipientCount">
              <th mat-header-cell *matHeaderCellDef>Recipients</th>
              <td mat-cell *matCellDef="let group">
                <div class="recipient-count">
                  <mat-icon class="count-icon">people</mat-icon>
                  <span>{{ getRecipientCount(group) }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let group">
                <div class="action-buttons-cell">
                  <radix-button variant="ghost" size="icon"
                          (onClick)="openEditGroupDialog(group)"
                          [attr.title]="'Edit group'">
                    <mat-icon>edit</mat-icon>
                  </radix-button>
                  <radix-button variant="destructive" size="icon"
                          (onClick)="deleteRecipientGroup(group)"
                          [attr.title]="'Delete group'">
                    <mat-icon>delete</mat-icon>
                  </radix-button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="groupDisplayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: groupDisplayedColumns;"></tr>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!loading && !error && shouldShowPagination()">
        <div class="pagination-info">
          <span *ngIf="viewMode === 'recipients'">
            Showing {{ ((currentPage - 1) * pageSize) + 1 }} to {{ Math.min(currentPage * pageSize, totalCount) }} of {{ totalCount }} recipients
          </span>
          <span *ngIf="viewMode === 'groups'">
            Showing {{ ((currentPage - 1) * pageSize) + 1 }} to {{ Math.min(currentPage * pageSize, recipientGroups.length) }} of {{ recipientGroups.length }} groups
          </span>
        </div>
        
        <div class="pagination-controls">
          <radix-button variant="ghost" 
                        [disabled]="currentPage === 1" 
                        (onClick)="onPageChange(currentPage - 1)">
            <mat-icon>chevron_left</mat-icon>
            Previous
          </radix-button>
          
          <div class="page-numbers">
            <radix-button *ngFor="let page of getPageNumbers()" 
                          variant="ghost"
                          [class.active]="page === currentPage"
                          (onClick)="onPageChange(page)">
              {{ page }}
            </radix-button>
          </div>
          
          <radix-button variant="ghost" 
                        [disabled]="currentPage === totalPages"
                        (onClick)="onPageChange(currentPage + 1)">
            Next
            <mat-icon>chevron_right</mat-icon>
          </radix-button>
        </div>
      </div>
    </div>
  </div>
</div>
